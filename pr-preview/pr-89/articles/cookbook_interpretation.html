<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Interpretation of Results • pacta.loanbook</title>
<link rel="icon" type="image/png" sizes="16x16" href="/headshot_placeholder.png">
<link rel="icon" type="image/png" sizes="32x32" href="/headshot_placeholder.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/headshot_placeholder.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Overpass-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Interpretation of Results">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-info" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pacta.loanbook</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-cookbook" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Cookbook</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-cookbook">
<li><a class="dropdown-item" href="../articles/cookbook_overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_preparatory_steps.html">Preparatory Steps</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_running_the_analysis.html">Running the Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_interpretation.html">Interpretation of Results</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_advanced_use_cases.html">Advanced Use Cases</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-data-dictionaries" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Data Dictionaries</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-data-dictionaries">
<li><a class="dropdown-item" href="../articles/data_loanbook.html">Loanbook</a></li>
    <li><a class="dropdown-item" href="../articles/data_abcd.html">ABCD</a></li>
    <li><a class="dropdown-item" href="../articles/data_scenario.html">Scenario</a></li>
    <li><a class="dropdown-item" href="../articles/data_classification.html">Classification</a></li>
    <li><a class="dropdown-item" href="../articles/data_outputs.html">Outputs</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>r2dii.match</h6></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.match/articles/matching-coverage.html">Calculating Matching Coverage</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.match/articles/chunk-your-data.html">Using match_name() with large loanbooks</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>r2dii.analysis</h6></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis/articles/target-sda.html">Sectoral Decarbonization Approach (SDA)</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis/articles/target-market-share.html">Market Share Approach</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis/articles/production-percent-change.html">Indicator Choices: Weighted Production vs. Weighted Percent Change in Production</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages">
<li><a class="dropdown-item" href="https://rmi-pacta.github.io/pacta.loanbook/">pacta.loanbook</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.data">r2dii.data</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.match">r2dii.match</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis">r2dii.analysis</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.plot">r2dii.plot</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/pacta_loanbook_sit_rep.html">sit.rep</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rmi-pacta/pacta.loanbook/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Interpretation of Results</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rmi-pacta/pacta.loanbook/blob/add-dictionary-for-R-CMD-check-incoming/vignettes/cookbook_interpretation.Rmd" class="external-link"><code>vignettes/cookbook_interpretation.Rmd</code></a></small>
      <div class="d-none name"><code>cookbook_interpretation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="calculating-matching-coverage">Calculating Matching Coverage<a class="anchor" aria-label="anchor" href="#calculating-matching-coverage"></a>
</h2>
<p><a href="https://rmi-pacta.github.io/r2dii.match/" class="external-link">r2dii.match</a> allows you to match loans from your
loanbook to the companies in an asset-based company dataset. However,
matching every loan is unlikely – some loan-taking companies may be
missing from the asset-based company dataset, or they may not operate in
the sectors PACTA focuses on (power, cement, oil and gas, aviation,
coal, automotive, steel, and hdv). Thus, you may want to measure how
much of the loanbook matched some asset. This article shows two ways to
calculate such matching coverage:</p>
<ol style="list-style-type: decimal">
<li><p>Calculate the portion of your loanbook covered, by dollar value
(i.e. using one of the <code>loan_size_*</code> columns).</p></li>
<li><p>Count the number of companies matched.</p></li>
</ol>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>First we will need to load additional useful packages
<a href="https://purrr.tidyverse.org/" class="external-link">purrr</a> and <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>We will use the example datasets created in the previous section. To
demonstrate our point, we create a <code>loanbook</code> dataset with
two mismatching loans:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook</span> <span class="op">&lt;-</span> <span class="va">loanbook</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    name_ultimate_parent <span class="op">=</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">id_loan</span> <span class="op">==</span> <span class="st">"L1"</span>, <span class="st">"unmatched company name"</span>, <span class="va">name_ultimate_parent</span><span class="op">)</span>,</span>
<span>    sector_classification_direct_loantaker <span class="op">=</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">id_loan</span> <span class="op">==</span> <span class="st">"L2"</span>, <span class="st">"99"</span>, <span class="va">sector_classification_direct_loantaker</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We will then run the matching algorithm on this loanbook:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="va">loanbook</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">match_name</span><span class="op">(</span><span class="va">abcd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">prioritize</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some `sector_classification_direct_loantaker` are unknown:99</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> If you wish to request a new sector classification system, please create an issue here:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> https://github.com/RMI-PACTA/r2dii.data/issues</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Or contact the PACTA team here:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> pacta4banks@rmi.org</span></span></code></pre></div>
<p>Note that this <code>matched</code> dataset will contain
<em>only</em> loans that were matched successfully. To determine
coverage, we need to go back to the original <code>loanbook</code>
dataset. We must determine the PACTA sectors of each loan, as dictated
by the <code>sector_classification_direct_loantaker</code> column.</p>
<p>For this, we join the loanbook with the
<code><a href="https://rmi-pacta.github.io/r2dii.data/reference/sector_classifications.html" class="external-link">r2dii.data::sector_classifications</a></code> dataset, which lists all
sector classification code standards used by ‘PACTA’. Unfortunately we
need to work around two caveats (you may ignore them because they are
conceptually uninteresting):</p>
<ul>
<li><p>In the two datasets, the columns we want to merge by have
different names. We use the argument <code>by</code> to
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code> to merge the columns
<code>sector_classification_system</code> and
<code>sector_classification_direct_loantaker</code> (from
<code>loanbook</code>) with the columns <code>code_system</code> and
<code>code</code> (from
<code><a href="https://rmi-pacta.github.io/r2dii.data/reference/sector_classifications.html" class="external-link">r2dii.data::sector_classifications</a></code>), respectively.</p></li>
<li><p>In the two datasets, the sector classification codes are
represented with different data-types. We modify the column
<code>sector_classification_direct_loantaker</code> before
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code> so it has the same type as the
corresponding column <code>code</code> (otherwise
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code> throws an error), and again after
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code> to restore its original type.</p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merge_by</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"code_system"</span>, <span class="st">"code"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sector_classification_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"system"</span>, <span class="st">"direct_loantaker"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">loanbook_with_sectors</span> <span class="op">&lt;-</span> <span class="va">loanbook</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="fu">r2dii.data</span><span class="fu">::</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.data/reference/sector_classifications.html" class="external-link">sector_classifications</a></span>, by <span class="op">=</span> <span class="va">merge_by</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/modify.html" class="external-link">modify_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">merge_by</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">as.character</span><span class="op">)</span></span></code></pre></div>
<p>We can join these two datasets together, to generate our
<code>coverage</code> dataset:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">loanbook_with_sectors</span>, <span class="va">matched</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    loan_size_outstanding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">loan_size_outstanding</span><span class="op">)</span>,</span>
<span>    loan_size_credit_limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">loan_size_credit_limit</span><span class="op">)</span>,</span>
<span>    matched <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="va">score</span> <span class="op">==</span> <span class="fl">1</span>   <span class="op">~</span> <span class="st">"Matched"</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Not Matched"</span>,</span>
<span>      <span class="cn">TRUE</span>         <span class="op">~</span> <span class="st">"Not Matched"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    sector <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="va">borderline</span> <span class="op">==</span> <span class="cn">TRUE</span> <span class="op">&amp;</span> <span class="va">matched</span> <span class="op">==</span> <span class="st">"Not Matched"</span> <span class="op">~</span> <span class="st">"not in scope"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">sector</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(id_loan, id_direct_loantaker, name_direct_loantaker,</span></span>
<span><span class="co">#&gt; id_ultimate_parent, name_ultimate_parent, loan_size_outstanding,</span></span>
<span><span class="co">#&gt; loan_size_outstanding_currency, loan_size_credit_limit,</span></span>
<span><span class="co">#&gt; loan_size_credit_limit_currency, sector_classification_system,</span></span>
<span><span class="co">#&gt; sector_classification_direct_loantaker, lei_direct_loantaker,</span></span>
<span><span class="co">#&gt; isin_direct_loantaker, sector, borderline)`</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-the-portion-of-your-loanbook-covered-by-dollar-value">1. Calculate the portion of your loanbook covered by dollar
value<a class="anchor" aria-label="anchor" href="#calculate-the-portion-of-your-loanbook-covered-by-dollar-value"></a>
</h3>
<p>From the <code>coverage</code> dataset, we can calculate the total
loanbook coverage by dollar value. Let’s create two helper functions,
one to calculate dollar-value and another one to plot coverage in
general.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dollar_value</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">summarize</span><span class="op">(</span>loan_size_outstanding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">loan_size_outstanding</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">matched</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plot_coverage</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">x</span><span class="op">}</span><span class="op">}</span>, <span class="op">{</span><span class="op">{</span><span class="va">y</span><span class="op">}</span><span class="op">}</span>, fill <span class="op">=</span> <span class="va">matched</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># Use more horizontal space -- avoids overlap on x axis text</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s first explore all loans.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dollar_value</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">matched</span>, <span class="va">loan_size_outstanding</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_interpretation_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>To calculate the total, in-scope, loanbook coverage:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sector</span> <span class="op">!=</span> <span class="st">"not in scope"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dollar_value</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">matched</span>, <span class="va">loan_size_outstanding</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_interpretation_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="break-down-by-sector">Break down by sector<a class="anchor" aria-label="anchor" href="#break-down-by-sector"></a>
</h3>
<p>You may break-down the plot by sector:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dollar_value</span><span class="op">(</span><span class="va">sector</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">sector</span>, <span class="va">loan_size_outstanding</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_interpretation_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Or even further, by matching level:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>matched <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"direct_loantaker"</span>      <span class="op">~</span> <span class="st">"Matched DL"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"intermediate_parent_1"</span> <span class="op">~</span> <span class="st">"Matched IP1"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"ultimate_parent"</span>       <span class="op">~</span> <span class="st">"Matched UP"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Not Matched"</span>                                <span class="op">~</span> <span class="st">"Not Matched"</span>,</span>
<span>    <span class="cn">TRUE</span>                                                    <span class="op">~</span> <span class="st">"Catch unknown"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dollar_value</span><span class="op">(</span><span class="va">sector</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">sector</span>, <span class="va">loan_size_outstanding</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_interpretation_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="count-the-number-of-companies">2. Count the number of companies<a class="anchor" aria-label="anchor" href="#count-the-number-of-companies"></a>
</h3>
<p>You might also be interested in knowing how many companies in your
loanbook were matched. It probably makes most sense to do this at the
<code>direct_loantaker</code> level:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">companies_matched</span> <span class="op">&lt;-</span> <span class="va">coverage</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>no_companies <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">name_direct_loantaker</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sector</span>, <span class="va">matched</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">companies_matched</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">sector</span>, <span class="va">no_companies</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_interpretation_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<p>There are a large variety of possible visualizations stemming from
the outputs of <code><a href="https://rmi-pacta.github.io/r2dii.analysis/reference/target_market_share.html" class="external-link">r2dii.analysis::target_market_share()</a></code> and
<code><a href="https://rmi-pacta.github.io/r2dii.analysis/reference/target_sda.html" class="external-link">r2dii.analysis::target_sda()</a></code>. Below, we highlight a couple
of common plots that can easily be created using the
<a href="https://github.com/RMI-PACTA/r2dii.plot" class="external-link">r2dii.plot</a> package.</p>
<div class="section level3">
<h3 id="market-share-sector-level-technology-mix">Market Share: Sector-level technology mix<a class="anchor" aria-label="anchor" href="#market-share-sector-level-technology-mix"></a>
</h3>
<p>From the market share output, you can plot the portfolio’s exposure
to various climate sensitive technologies (<code>projected</code>), and
compare with the corporate economy, or against various scenario
targets.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pick the targets you want to plot.</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">market_share_targets_portfolio</span>,</span>
<span>  <span class="va">scenario_source</span> <span class="op">==</span> <span class="st">"demo_2020"</span>,</span>
<span>  <span class="va">sector</span> <span class="op">==</span> <span class="st">"power"</span>,</span>
<span>  <span class="va">region</span> <span class="op">==</span> <span class="st">"global"</span>,</span>
<span>  <span class="va">metric</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"projected"</span>, <span class="st">"corporate_economy"</span>, <span class="st">"target_sds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the technology mix</span></span>
<span><span class="fu">qplot_techmix</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; The `technology_share` values are plotted for extreme years.</span></span>
<span><span class="co">#&gt; Do you want to plot different years? E.g. filter . with:`subset(., year %in% c(2020, 2030))`.</span></span>
<span><span class="co">#&gt; Warning: Removed 3 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_bar()`).</span></span></code></pre></div>
<p><img src="cookbook_interpretation_files/figure-html/technoloy-mix-portfolio-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="market-share-technology-level-volume-trajectory">Market Share: Technology-level volume trajectory<a class="anchor" aria-label="anchor" href="#market-share-technology-level-volume-trajectory"></a>
</h3>
<p>You can also plot the technology-specific volume trend. All starting
values are normalized to 1, to emphasize that we are comparing the rates
of buildout and/or retirement.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">market_share_targets_portfolio</span>,</span>
<span>  <span class="va">sector</span> <span class="op">==</span> <span class="st">"power"</span>,</span>
<span>  <span class="va">technology</span> <span class="op">==</span> <span class="st">"renewablescap"</span>,</span>
<span>  <span class="va">region</span> <span class="op">==</span> <span class="st">"global"</span>,</span>
<span>  <span class="va">scenario_source</span> <span class="op">==</span> <span class="st">"demo_2020"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">qplot_trajectory</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_interpretation_files/figure-html/trajetory-portfolio-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="sda-target">SDA Target<a class="anchor" aria-label="anchor" href="#sda-target"></a>
</h3>
<p>From the SDA output, we can compare the projected average emission
intensity attributed to the portfolio, with the actual emission
intensity scenario, and the scenario compliant SDA pathway that the
portfolio must follow to achieve the scenario ambition by 2050.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sda_targets</span>, <span class="va">sector</span> <span class="op">==</span> <span class="st">"cement"</span>, <span class="va">region</span> <span class="op">==</span> <span class="st">"global"</span><span class="op">)</span></span>
<span><span class="fu">qplot_emission_intensity</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_interpretation_files/figure-html/sda%20plot-1.png" width="700"></p>
<p><strong>PREVIOUS CHAPTER:</strong> <a href="cookbook_running_the_analysis.html">Running the Analysis</a></p>
<p><strong>NEXT CHAPTER:</strong> <a href="cookbook_advanced_use_cases.html">Advanced Use Cases</a></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="../rmi_logo_stacked_tag_white.svg" alt="RMI logo">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://pacta.rmi.org/" target="_blank" class="external-link"><div class="icon fa fa-link"></div></a>
                        <a href="https://github.com/RMI-PACTA" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://twitter.com/RockyMtnInst" target="_blank" class="external-link"><div class="icon fab fa-twitter"></div></a>
                        <a href="https://www.linkedin.com/showcase/rmi-pacta/" target="_blank" class="external-link"><div class="icon fab fa-linkedin-in"></div></a>
                    </div>
                </div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>© RMI</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
</div>
<!-- / end footer -->

    
   





  </body>
</html>
