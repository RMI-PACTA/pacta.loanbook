<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Running the Analysis • pacta.loanbook</title>
<link rel="icon" type="image/png" sizes="16x16" href="/headshot_placeholder.png">
<link rel="icon" type="image/png" sizes="32x32" href="/headshot_placeholder.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/headshot_placeholder.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Overpass-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Running the Analysis">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-info" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pacta.loanbook</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-cookbook" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Cookbook</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-cookbook">
<li><a class="dropdown-item" href="../articles/cookbook_overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_preparatory_steps.html">Preparatory Steps</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_running_the_analysis.html">Running the Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_interpretation.html">Interpretation of Results</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_advanced_use_cases.html">Advanced Use Cases</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>r2dii.match</h6></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.match/articles/matching-coverage.html">Calculating Matching Coverage</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.match/articles/chunk-your-data.html">Using match_name() with large loanbooks</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>r2dii.analysis</h6></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis/articles/target-sda.html">Sectoral Decarbonization Approach (SDA)</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis/articles/target-market-share.html">Market Share Approach</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis/articles/production-percent-change.html">Indicator Choices: Weighted Production vs. Weighted Percent Change in Production</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages">
<li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.data">r2dii.data</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.match">r2dii.match</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis">r2dii.analysis</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.plot">r2dii.plot</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/pacta_loanbook_sit_rep.html">sit.rep</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rmi-pacta/pacta.loanbook/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Running the Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rmi-pacta/pacta.loanbook/blob/add-cookbook-running-the-analysis/vignettes/cookbook_running_the_analysis.Rmd" class="external-link"><code>vignettes/cookbook_running_the_analysis.Rmd</code></a></small>
      <div class="d-none name"><code>cookbook_running_the_analysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We use the <code>r2dii.*</code> suite of packages to access the most
important functions you’ll learn about. We also use example datasets
from the package <a href="https://rmi-pacta.github.io/r2dii.data/" class="external-link">r2dii.data</a>, and optional but convenient
functions from the packages <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> and
<a href="https://readxl.tidyverse.org" class="external-link">readxl</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.match/" class="external-link">r2dii.match</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RMI-PACTA/r2dii.analysis" class="external-link">r2dii.analysis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RMI-PACTA/r2dii.plot" class="external-link">r2dii.plot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.data/" class="external-link">r2dii.data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="import-data">Import data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h2>
<p>We need two datasets to begin: a <a href="cookbook_preparatory_steps.html#raw-loan-book">loanbook</a> and an
<a href="cookbook_preparatory_steps.html#asset-based-company-data-abcd">asset-based
company dataset (abcd)</a>.</p>
<p>To simulate having these data files prepared, we will use the demo
data included in the <a href="https://rmi-pacta.github.io/r2dii.data/" class="external-link">r2dii.data</a> package to create example
XLS files using the <a href="https://ropensci.r-universe.dev/writexl" class="external-link">writexl</a> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.r-universe.dev/writexl" class="external-link">writexl</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">writexl</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/writexl/reference/write_xlsx.html" class="external-link">write_xlsx</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu">r2dii.data</span><span class="fu">::</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.data/reference/loanbook_demo.html" class="external-link">loanbook_demo</a></span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"loanbook.xlsx"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">writexl</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/writexl/reference/write_xlsx.html" class="external-link">write_xlsx</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu">r2dii.data</span><span class="fu">::</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.data/reference/abcd_demo.html" class="external-link">abcd_demo</a></span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"abcd.xlsx"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Typically, these data files are stored in XLS files on your computer.
As an example, they could be imported as in the code below using the
<a href="https://readxl.tidyverse.org" class="external-link">readxl</a> package, however, if you use custom data that does
not strictly follow the format as defined in <a href="cookbook_preparatory_steps.html">the previous section</a>, you may
need to adjust the import code and/or do some data manipulation in R
after importing.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"loanbook.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">loanbook</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 283 × 13</span></span></span>
<span><span class="co">#&gt;    id_loan id_direct_loantaker name_direct_loantaker       id_ultimate_parent</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> L1      C294                Vitale Group                UP15              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> L2      C293                Moen-Moen                   UP84              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> L3      C292                Rowe-Rowe                   UP288             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> L4      C299                Fadel-Fadel                 UP54              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> L5      C305                Ring AG &amp; Co. KGaA          UP104             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> L6      C304                Kassulke-Kassulke           UP83              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> L7      C227                Morissette Group            UP134             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> L8      C303                Barone s.r.l.               UP163             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> L9      C301                Werner Werner AG &amp; Co. KGaA UP138             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> L10     C302                De rosa s.r.l.              UP32              </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 273 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9 more variables: name_ultimate_parent &lt;chr&gt;, loan_size_outstanding &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   loan_size_outstanding_currency &lt;chr&gt;, loan_size_credit_limit &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   loan_size_credit_limit_currency &lt;chr&gt;, sector_classification_system &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   sector_classification_direct_loantaker &lt;chr&gt;, lei_direct_loantaker &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   isin_direct_loantaker &lt;lgl&gt;</span></span></span>
<span></span>
<span><span class="va">abcd</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"abcd.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">abcd</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,972 × 12</span></span></span>
<span><span class="co">#&gt;    company_id name_company         lei   sector technology production_unit  year</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 175        Giordano, Giordano … 1850… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>020</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 175        Giordano, Giordano … 1850… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>021</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 175        Giordano, Giordano … 1850… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>022</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 175        Giordano, Giordano … 1850… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>023</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 175        Giordano, Giordano … 1850… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>024</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 175        Giordano, Giordano … 1850… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>025</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 526        Vitali, Vitali e Vi… 8871… cement integrate… tonnes per year  <span style="text-decoration: underline;">2</span>020</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 526        Vitali, Vitali e Vi… 8871… cement integrate… tonnes per year  <span style="text-decoration: underline;">2</span>021</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 526        Vitali, Vitali e Vi… 8871… cement integrate… tonnes per year  <span style="text-decoration: underline;">2</span>022</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 526        Vitali, Vitali e Vi… 8871… cement integrate… tonnes per year  <span style="text-decoration: underline;">2</span>023</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,962 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: production &lt;dbl&gt;, emission_factor &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   plant_location &lt;chr&gt;, is_ultimate_owner &lt;lgl&gt;, emission_factor_unit &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="score-the-goodness-of-the-match-between-the-loanbook-and-abcd-datasets">Score the goodness of the match between the loanbook and abcd
datasets<a class="anchor" aria-label="anchor" href="#score-the-goodness-of-the-match-between-the-loanbook-and-abcd-datasets"></a>
</h2>
<p><code><a href="https://rmi-pacta.github.io/r2dii.match/reference/match_name.html" class="external-link">match_name()</a></code> scores the match between names in a
loanbook dataset and names in an asset-based company dataset. The names
come from the columns <code>name_direct_loantaker</code> and
<code>name_ultimate_parent</code> of the loanbook dataset, and from the
column <code>name_company</code> of the asset-based company dataset. In
the loan book data set, it is possible to optionally add any number of
<code>name_intermediate_parent_*</code> columns, where <code>*</code>
indicates the level up the corporate tree from
<code>direct_loantaker</code>.</p>
<p>The raw names are internally transformed applying best-practices
commonly used in name matching algorithms, such as:</p>
<ul>
<li>Remove special characters</li>
<li>Replace language specific characters</li>
<li>Abbreviate certain names to reduce their importance in the
matching</li>
<li>Remove corporate suffixes when necessary</li>
<li>Spell out numbers to increase their importance</li>
</ul>
<p>The similarity is then scored between the internally-transformed
names of the loanbook against the names in the abcd. For more
information on the scoring algorithm used, see
<code><a href="https://rdrr.io/pkg/stringdist/man/stringsim.html" class="external-link">stringdist::stringsim()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rmi-pacta.github.io/r2dii.match/reference/match_name.html" class="external-link">match_name</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">abcd</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 326 × 22</span></span></span>
<span><span class="co">#&gt;    id_loan id_direct_loantaker name_direct_loantaker       id_ultimate_parent</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> L1      C294                Vitale Group                UP15              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> L3      C292                Rowe-Rowe                   UP288             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> L5      C305                Ring AG &amp; Co. KGaA          UP104             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> L6      C304                Kassulke-Kassulke           UP83              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> L6      C304                Kassulke-Kassulke           UP83              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> L7      C227                Morissette Group            UP134             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> L7      C227                Morissette Group            UP134             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> L8      C303                Barone s.r.l.               UP163             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> L9      C301                Werner Werner AG &amp; Co. KGaA UP138             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> L9      C301                Werner Werner AG &amp; Co. KGaA UP138             </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 316 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 18 more variables: name_ultimate_parent &lt;chr&gt;, loan_size_outstanding &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   loan_size_outstanding_currency &lt;chr&gt;, loan_size_credit_limit &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   loan_size_credit_limit_currency &lt;chr&gt;, sector_classification_system &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   sector_classification_direct_loantaker &lt;chr&gt;, lei_direct_loantaker &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   isin_direct_loantaker &lt;lgl&gt;, id_2dii &lt;chr&gt;, level &lt;chr&gt;, sector &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   sector_abcd &lt;chr&gt;, name &lt;chr&gt;, name_abcd &lt;chr&gt;, score &lt;dbl&gt;, …</span></span></span></code></pre></div>
<p><code><a href="https://rmi-pacta.github.io/r2dii.match/reference/match_name.html" class="external-link">match_name()</a></code> defaults to scoring matches between name
strings that belong to the same sector. Using
<code>by_sector = FALSE</code> removes this limitation – increasing
computation time, and the number of potentially incorrect matches to
manually validate.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rmi-pacta.github.io/r2dii.match/reference/match_name.html" class="external-link">match_name</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">abcd</span>, by_sector <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 656</span></span>
<span></span>
<span><span class="co"># Compare to</span></span>
<span><span class="fu"><a href="https://rmi-pacta.github.io/r2dii.match/reference/match_name.html" class="external-link">match_name</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">abcd</span>, by_sector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 326</span></span></code></pre></div>
<p>The <code>min_score</code> argument allows you to set a minimum
threshold score.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rmi-pacta.github.io/r2dii.match/reference/match_name.html" class="external-link">match_name</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">abcd</span>, min_score <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9007692 1.0000000</span></span></code></pre></div>
<div class="section level3">
<h3 id="maybe-overwrite-matches">Maybe overwrite matches<a class="anchor" aria-label="anchor" href="#maybe-overwrite-matches"></a>
</h3>
<p>If you are happy with the matching coverage achieved, proceed to the
next step. Otherwise, you can manually add matches, not found
automatically by <code><a href="https://rmi-pacta.github.io/r2dii.match/reference/match_name.html" class="external-link">match_name()</a></code>. To do this, manually inspect
the <code>abcd</code> and find a company you would like to match to your
loanbook. Once a match is found, use excel to write a .csv file similar
to <a href="https://rmi-pacta.github.io/r2dii.data/reference/overwrite_demo.html" class="external-link"><code>r2dii.data::overwrite_demo</code></a>,
where:</p>
<ul>
<li>
<code>level</code> indicates the level that the manual match should
be added to (e.g. <code>direct_loantaker</code>)</li>
<li>
<code>id_2dii</code> is the id of the loanbook company you would
like to match (from the output of <code><a href="https://rmi-pacta.github.io/r2dii.match/reference/match_name.html" class="external-link">match_name()</a></code>)</li>
<li>
<code>name</code> is the abcd company you would like to manually
link to</li>
<li>
<code>sector</code> optionally you can also overwrite the
sector.</li>
<li>
<code>source</code> this can be used later to determine where all
manual matches came from.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rmi-pacta.github.io/r2dii.match/reference/match_name.html" class="external-link">match_name</a></span><span class="op">(</span></span>
<span>    loanbook <span class="op">=</span> <span class="va">loanbook</span>,</span>
<span>    abcd <span class="op">=</span> <span class="va">abcd</span>,</span>
<span>    min_score <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>    overwrite <span class="op">=</span> <span class="fu">r2dii.data</span><span class="fu">::</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.data/reference/overwrite_demo.html" class="external-link">overwrite_demo</a></span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: You should only overwrite a sector at the level of the 'direct</span></span>
<span><span class="co">#&gt; loantaker' (DL). If you overwrite a sector at the level of the 'ultimate</span></span>
<span><span class="co">#&gt; parent' (UP) you consequently overwrite all children of that sector,</span></span>
<span><span class="co">#&gt; which most likely is a mistake.</span></span></code></pre></div>
<p>Notice the warning.</p>
</div>
</div>
<div class="section level2">
<h2 id="validate-matches">Validate matches<a class="anchor" aria-label="anchor" href="#validate-matches"></a>
</h2>
<p>Write the output of <code><a href="https://rmi-pacta.github.io/r2dii.match/reference/match_name.html" class="external-link">match_name()</a></code> into a .csv file, for
example using <a href="https://readr.tidyverse.org" class="external-link">readr</a> to save a CSV file:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">matched</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"matched.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Compare, edit, and save the data manually:</p>
<ul>
<li>Open <code>matched.csv</code> with any spreadsheet editor (Excel,
Google Sheets, etc.).</li>
<li>Compare the columns <code>name</code> and <code>name_abcd</code>
manually to determine if the match is valid. Other information can be
used in conjunction with just the names to ensure the two entities match
(sector, internal information on the company structure, etc.)</li>
<li>Edit the data:
<ul>
<li>If you are happy with the match, set the <code>score</code> value to
<code>1</code>.</li>
<li>Otherwise set or leave the <code>score</code> value to anything
other than <code>1</code>.</li>
</ul>
</li>
<li>Save the edited file as, for example,
<code>valid_matches.csv</code>.</li>
</ul>
<p>Re-import the edited file (validated), for example using
<a href="https://readr.tidyverse.org" class="external-link">readr</a> to read a CSV file:</p>
<p>For more information on validating matches, please see the
documentation for <code><a href="https://rmi-pacta.github.io/r2dii.match/reference/prioritize.html" class="external-link">prioritize()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="prioritize-validated-matches-by-level">Prioritize validated matches by level<a class="anchor" aria-label="anchor" href="#prioritize-validated-matches-by-level"></a>
</h2>
<p>The validated dataset may have multiple matches per loan. Consider
the case where a loan is given to “Acme Power USA”, a subsidiary of
“Acme Power Co.”. There may be both “Acme Power USA” and “Acme Power
Co.” in the <code>abcd</code>, and so there could be two valid matches
for this loan. To get the best match only, use <code><a href="https://rmi-pacta.github.io/r2dii.match/reference/prioritize.html" class="external-link">prioritize()</a></code>
– it picks rows where <code>score</code> is 1 and <code>level</code> per
loan is of highest <code>priority</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">some_interesting_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id_2dii"</span>, <span class="st">"level"</span>, <span class="st">"score"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prioritized_matches</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">valid_matches</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rmi-pacta.github.io/r2dii.match/reference/prioritize.html" class="external-link">prioritize</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prioritized_matches</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">some_interesting_columns</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 175 × 3</span></span></span>
<span><span class="co">#&gt;    id_2dii level            score</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> DL129   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> DL144   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> DL270   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> DL86    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> DL5     direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> DL80    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> DL150   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> DL3     direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> DL65    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> DL79    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 165 more rows</span></span></span></code></pre></div>
<p>By default, highest priority refers to the most granular match
(<code>direct_loantaker</code>). The default priority is set internally
via <code><a href="https://rmi-pacta.github.io/r2dii.match/reference/prioritize_level.html" class="external-link">prioritize_level()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rmi-pacta.github.io/r2dii.match/reference/prioritize_level.html" class="external-link">prioritize_level</a></span><span class="op">(</span><span class="va">valid_matches</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "direct_loantaker" "ultimate_parent"</span></span></code></pre></div>
<p>You may use a different priority. One way to do that is to pass a
function to <code>priority</code>. For example, use <code><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev()</a></code>
to reverse the default priority.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valid_matches</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rmi-pacta.github.io/r2dii.match/reference/prioritize.html" class="external-link">prioritize</a></span><span class="op">(</span>priority <span class="op">=</span> <span class="va">rev</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">some_interesting_columns</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 175 × 3</span></span></span>
<span><span class="co">#&gt;    id_2dii level           score</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> UP190   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> UP101   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> UP39    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> UP63    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> UP224   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> UP132   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> UP12    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> UP20    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> UP134   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> UP127   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 165 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-note-on-sector-classifications-and-the-borderline-flag">A Note on Sector Classifications and the <code>borderline</code>
Flag<a class="anchor" aria-label="anchor" href="#a-note-on-sector-classifications-and-the-borderline-flag"></a>
</h2>
<p>A note on sector classification: Matches are preferred when the
sector from the <code>loanbook</code> matches the sector from the
<code>abcd</code>. The <code>loanbook</code> sector is determined
internally using the <code>sector_classification_system</code> and
<code>sector_classification_direct_loantaker</code> columns. Currently,
we only allow a couple specific values for
<code>sector_classification_system</code>:</p>
<blockquote>
<p>GICS, ISIC, NACE, NAICS, PSIC, SIC</p>
</blockquote>
<p>If you would like to use a different classification system, please
raise an issue in <a href="https://github.com/RMI-PACTA/r2dii.data" class="external-link">r2dii.data</a> and we can
incorporate it.</p>
<p>There are a zoo of sector classification code systems out there. Some
are granular, some are not. Since we currently cover a particular
portion of the supply chain (i.e. production), it is important we try to
only match the ABCD with companies that are actually active in this
portion of the supply chain.</p>
<p>An issue arises when, for example, a company is classified in the
“power transmission” sector. In a perfect world, these companies would
produce no electricity, and we would not try to match them. In practice,
however, we find there is often overlap. For this reason, we introduced
the <code>borderline</code> flag.</p>
<p>In the example below, we see two classification codes coming from the
SIC classification standard:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">r2dii.data</span><span class="fu">::</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.data/reference/nace_classification.html" class="external-link">nace_classification</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D35.11"</span>, <span class="st">"D35.14"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   original_code description                      code  sector borderline version</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 35.11         35.11 Production of electricity… D35.… power  FALSE      2.1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 35.14         35.14 Distribution of electrici… D35.… power  TRUE       2.1</span></span></code></pre></div>
<p>Notice that the code D35.11 corresponds to power generation. This is
an identical match to PACTA’s <code>power</code> sector, and thus the
<code>borderline</code> flag is set to <code>FALSE</code>. In contrast,
code D35.14 corresponds to the distribution of electricity. In a perfect
world, we would set this code to <code>not in scope</code>, however
there is still a chance that these companies produce electricity. For
this reason, we have mapped it to <code>power</code> with
<code>borderline = TRUE</code>.</p>
<p>In practice, if a company has a <code>borderline</code> of
<code>TRUE</code> and <em>is</em> matched, then consider the company in
scope. If it has a <code>borderline</code> of <code>TRUE</code> and
<em>isn’t</em> matched, then consider it out of scope.</p>
</div>
<div class="section level2">
<h2 id="calculate-targets">Calculate targets<a class="anchor" aria-label="anchor" href="#calculate-targets"></a>
</h2>
<p>You can calculate scenario targets using two different approaches:
Market Share Approach, or Sectoral Decarbonization Approach.</p>
<div class="section level3">
<h3 id="market-share-approach">Market Share Approach<a class="anchor" aria-label="anchor" href="#market-share-approach"></a>
</h3>
<p>The <a href="https://rmi-pacta.github.io/r2dii.analysis/articles/target-market-share.html" class="external-link">Market
Share Approach</a> is used to calculate scenario targets for the
<code>production</code> of a technology in a sector. For example, we can
use this approach to set targets for the production of electric vehicles
in the automotive sector. This approach is recommended for sectors where
a granular technology scenario roadmap exists.</p>
<p>Targets can be set at the portfolio level:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use these datasets to practice but eventually you should use your own data.</span></span>
<span><span class="va">scenario</span> <span class="op">&lt;-</span> <span class="fu">r2dii.data</span><span class="fu">::</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.data/reference/scenario_demo_2020.html" class="external-link">scenario_demo_2020</a></span></span>
<span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu">r2dii.data</span><span class="fu">::</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.data/reference/region_isos_demo.html" class="external-link">region_isos_demo</a></span></span>
<span></span>
<span><span class="va">market_share_targets_portfolio</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rmi-pacta.github.io/r2dii.analysis/reference/target_market_share.html" class="external-link">target_market_share</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">prioritized_matches</span>,</span>
<span>    abcd <span class="op">=</span> <span class="va">abcd</span>,</span>
<span>    scenario <span class="op">=</span> <span class="va">scenario</span>,</span>
<span>    region_isos <span class="op">=</span> <span class="va">regions</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">market_share_targets_portfolio</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,076 × 10</span></span></span>
<span><span class="co">#&gt;    sector     technology  year region scenario_source metric     production</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       projected     <span style="text-decoration: underline;">139</span>052.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       target_cps    <span style="text-decoration: underline;">139</span>052.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       target_sds    <span style="text-decoration: underline;">139</span>052.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       target_sps    <span style="text-decoration: underline;">139</span>052.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> automotive electric    <span style="text-decoration: underline;">2</span>021 global demo_2020       projected     <span style="text-decoration: underline;">140</span>395.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> automotive electric    <span style="text-decoration: underline;">2</span>021 global demo_2020       target_cps    <span style="text-decoration: underline;">140</span>195.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> automotive electric    <span style="text-decoration: underline;">2</span>021 global demo_2020       target_sds    <span style="text-decoration: underline;">145</span>990.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> automotive electric    <span style="text-decoration: underline;">2</span>021 global demo_2020       target_sps    <span style="text-decoration: underline;">140</span>505.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> automotive electric    <span style="text-decoration: underline;">2</span>022 global demo_2020       projected     <span style="text-decoration: underline;">141</span>737.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> automotive electric    <span style="text-decoration: underline;">2</span>022 global demo_2020       target_cps    <span style="text-decoration: underline;">141</span>314.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,066 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: technology_share &lt;dbl&gt;, scope &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   percentage_of_initial_production_by_scope &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Or at the company level:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">market_share_targets_company</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rmi-pacta.github.io/r2dii.analysis/reference/target_market_share.html" class="external-link">target_market_share</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">prioritized_matches</span>,</span>
<span>    abcd <span class="op">=</span> <span class="va">abcd</span>,</span>
<span>    scenario <span class="op">=</span> <span class="va">scenario</span>,</span>
<span>    region_isos <span class="op">=</span> <span class="va">regions</span>,</span>
<span>    by_company <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># Output results at company-level</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: You've supplied `by_company = TRUE` and `weight_production = TRUE`.</span></span>
<span><span class="co">#&gt; This will result in company-level results, weighted by the portfolio</span></span>
<span><span class="co">#&gt; loan size, which is rarely useful. Did you mean to set one of these</span></span>
<span><span class="co">#&gt; arguments to `FALSE`?</span></span>
<span></span>
<span><span class="va">market_share_targets_company</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14,505 × 11</span></span></span>
<span><span class="co">#&gt;    sector    technology  year region scenario_source name_abcd metric production</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> automoti… electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Bernardi… proje…      <span style="text-decoration: underline;">6</span>646.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> automoti… electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Bernardi… targe…      <span style="text-decoration: underline;">6</span>646.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> automoti… electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Bernardi… targe…      <span style="text-decoration: underline;">6</span>646.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> automoti… electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Bernardi… targe…      <span style="text-decoration: underline;">6</span>646.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> automoti… electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Christia… proje…     <span style="text-decoration: underline;">11</span>894.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> automoti… electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Christia… targe…     <span style="text-decoration: underline;">11</span>894.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> automoti… electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Christia… targe…     <span style="text-decoration: underline;">11</span>894.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> automoti… electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Christia… targe…     <span style="text-decoration: underline;">11</span>894.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> automoti… electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Donati, … proje…      <span style="text-decoration: underline;">5</span>818.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> automoti… electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Donati, … targe…      <span style="text-decoration: underline;">5</span>818.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 14,495 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: technology_share &lt;dbl&gt;, scope &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   percentage_of_initial_production_by_scope &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sectoral-decarbonization-approach">Sectoral Decarbonization Approach<a class="anchor" aria-label="anchor" href="#sectoral-decarbonization-approach"></a>
</h3>
<p>The <a href="https://rmi-pacta.github.io/r2dii.analysis/articles/target-sda.html" class="external-link">Sectoral
Decarbonization Approach</a> is used to calculate scenario targets for
the <code>emission_factor</code> of a sector. For example, you can use
this approach to set targets for the average emission factor of the
cement sector. This approach is recommended for sectors lacking
technology roadmaps.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use this dataset to practice but eventually you should use your own data.</span></span>
<span><span class="va">co2</span> <span class="op">&lt;-</span> <span class="fu">r2dii.data</span><span class="fu">::</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.data/reference/co2_intensity_scenario_demo.html" class="external-link">co2_intensity_scenario_demo</a></span></span>
<span></span>
<span><span class="va">sda_targets</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rmi-pacta.github.io/r2dii.analysis/reference/target_sda.html" class="external-link">target_sda</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">prioritized_matches</span>,</span>
<span>    abcd <span class="op">=</span> <span class="va">abcd</span>,</span>
<span>    co2_intensity_scenario <span class="op">=</span> <span class="va">co2</span>,</span>
<span>    region_isos <span class="op">=</span> <span class="va">regions</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sector</span> <span class="op">==</span> <span class="st">"cement"</span>, <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2020</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removing rows in abcd where `emission_factor` is NA</span></span>
<span></span>
<span><span class="va">sda_targets</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 110 × 6</span></span></span>
<span><span class="co">#&gt;    sector  year region             scenario_source emission_factor_metric</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> cement  <span style="text-decoration: underline;">2</span>020 advanced economies demo_2020       projected             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> cement  <span style="text-decoration: underline;">2</span>020 developing asia    demo_2020       projected             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> cement  <span style="text-decoration: underline;">2</span>020 global             demo_2020       projected             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> cement  <span style="text-decoration: underline;">2</span>021 advanced economies demo_2020       projected             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> cement  <span style="text-decoration: underline;">2</span>021 developing asia    demo_2020       projected             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> cement  <span style="text-decoration: underline;">2</span>021 global             demo_2020       projected             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> cement  <span style="text-decoration: underline;">2</span>022 advanced economies demo_2020       projected             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> cement  <span style="text-decoration: underline;">2</span>022 developing asia    demo_2020       projected             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> cement  <span style="text-decoration: underline;">2</span>022 global             demo_2020       projected             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> cement  <span style="text-decoration: underline;">2</span>023 advanced economies demo_2020       projected             </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 100 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: emission_factor_value &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="../rmi_logo_stacked_tag_white.svg" alt="RMI logo">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://pacta.rmi.org/" target="_blank" class="external-link"><div class="icon fa fa-link"></div></a>
                        <a href="https://github.com/RMI-PACTA" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://twitter.com/RockyMtnInst" target="_blank" class="external-link"><div class="icon fab fa-twitter"></div></a>
                        <a href="https://www.linkedin.com/showcase/rmi-pacta/" target="_blank" class="external-link"><div class="icon fab fa-linkedin-in"></div></a>
                    </div>
                </div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>© RMI</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
</div>
<!-- / end footer -->

    
   





  </body>
</html>
