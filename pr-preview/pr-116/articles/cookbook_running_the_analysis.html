<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Running the Analysis • pacta.loanbook</title>
<link rel="icon" type="image/png" sizes="16x16" href="/headshot_placeholder.png">
<link rel="icon" type="image/png" sizes="32x32" href="/headshot_placeholder.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/headshot_placeholder.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Overpass-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Running the Analysis">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-info" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pacta.loanbook</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-cookbook" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Cookbook</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-cookbook">
<li><a class="dropdown-item" href="../articles/cookbook_overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_preparatory_steps.html">Preparatory Steps</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_running_the_analysis.html">Running the Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_interpretation.html">Interpretation of Results</a></li>
    <li><a class="dropdown-item" href="../articles/cookbook_advanced_use_cases.html">Advanced Use Cases</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-data-dictionaries" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Data Dictionaries</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-data-dictionaries">
<li><a class="dropdown-item" href="../articles/data_loanbook.html">Loanbook</a></li>
    <li><a class="dropdown-item" href="../articles/data_abcd.html">ABCD</a></li>
    <li><a class="dropdown-item" href="../articles/data_scenario.html">Scenario</a></li>
    <li><a class="dropdown-item" href="../articles/data_classification.html">Classification</a></li>
    <li><a class="dropdown-item" href="../articles/data_outputs.html">Outputs</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>r2dii.match</h6></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.match/articles/matching-coverage.html">Calculating Matching Coverage</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.match/articles/chunk-your-data.html">Using match_name() with large loanbooks</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>r2dii.analysis</h6></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis/articles/target-sda.html">Sectoral Decarbonization Approach (SDA)</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis/articles/target-market-share.html">Market Share Approach</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis/articles/production-percent-change.html">Indicator Choices: Weighted Production vs. Weighted Percent Change in Production</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages">
<li><a class="dropdown-item" href="https://rmi-pacta.github.io/pacta.loanbook/">pacta.loanbook</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.data/">r2dii.data</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.match/">r2dii.match</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis/">r2dii.analysis</a></li>
    <li><a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.plot/">r2dii.plot</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/pacta_loanbook_sit_rep.html">sit.rep</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rmi-pacta/pacta.loanbook/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="cookbook_running_the_analysis_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="cookbook_running_the_analysis_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="cookbook_running_the_analysis_files/d3-3.3.8/d3.min.js"></script><script src="cookbook_running_the_analysis_files/dagre-0.4.0/dagre-d3.min.js"></script><link href="cookbook_running_the_analysis_files/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="cookbook_running_the_analysis_files/mermaid-0.3.0/dist/mermaid.slim.min.js"></script><link href="cookbook_running_the_analysis_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="cookbook_running_the_analysis_files/chromatography-0.1/chromatography.js"></script><script src="cookbook_running_the_analysis_files/DiagrammeR-binding-1.0.11/DiagrammeR.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Running the Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rmi-pacta/pacta.loanbook/blob/path-running-the-analysis/vignettes/cookbook_running_the_analysis.Rmd" class="external-link"><code>vignettes/cookbook_running_the_analysis.Rmd</code></a></small>
      <div class="d-none name"><code>cookbook_running_the_analysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="running-the-analysis">Running the Analysis<a class="anchor" aria-label="anchor" href="#running-the-analysis"></a>
</h2>
<p>This section provides a brief overview of the main steps required to
run the PACTA for Banks analysis. It starts with a high-level overview
and elaborates on each step in more detail below. The whole process is
demonstrated with code-snippets so that following them in your own
environment is as straight-forward as possible.</p>
<div class="section level3">
<h3 id="structure-of-the-workflow">Structure of the Workflow<a class="anchor" aria-label="anchor" href="#structure-of-the-workflow"></a>
</h3>
<p>Assuming you have prepared and/or procured all required input data
sets as described in the section <a href="cookbook_preparatory_steps.html">“Preparatory Steps”</a>,
implementing the PACTA for Banks analysis now follows the following main
steps:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Setup</strong>: Load the necessary packages and import the
data.</li>
<li>
<strong>Matching process</strong>: Match the counterparties in the
raw input loan book with the companies in the asset-based company
data.</li>
<li>
<strong>Calculate PACTA metrics</strong>: Run the PACTA analysis to
obtain alignment metrics for the matched loan book relative to
benchmarks based on transition scenarios.</li>
<li>
<strong>Plot PACTA metrics</strong>: Visualize the results of the
PACTA analysis using the standard PACTA plots to facilitate
interpretation.</li>
</ol>
<div class="figure" style="text-align: center">
<div class="DiagrammeR html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"\n  graph TB;\n    id1(\"Setup\") --> id2(\"Matching process\");\n    id2(\"Matching process\") --> id3(\"Calculate PACTA metrics\");\n    id3(\"Calculate PACTA metrics\") --> id4(\"Visualize PACTA metrics\");\n    classDef nodeStyle fill: #45cfcc, stroke: #000, stroke-width: 2px;\n    class id1,id2,id3,id4 nodeStyle;\n    click id1 \"#setup\";\n    click id2 \"#matching-process\";\n    click id3 \"#calculate-pacta-alignment-metrics\";\n    click id4 \"#visualize-pacta-alignment-metrics\";\n"},"evals":[],"jsHooks":[]}</script><p class="caption">
Fig. 1: Structure of the Workflow
</p>
</div>
<p>In principle, these steps are sequential. However, in practice it has
shown that one rarely ever achieves the best possible match rate in one
iteration. Therefore, it may be required to iterate the matching process
multiple times. We will cover these steps in more detail now.</p>
</div>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>We use the <a href="https://rmi-pacta.github.io/pacta.loanbook/">pacta.loanbook</a> package to access the most
important functions you’ll learn about. We also use example datasets
from the package <a href="https://rmi-pacta.github.io/pacta.loanbook/">pacta.loanbook</a>, and optional but
convenient functions from the packages <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>,
<a href="https://readxl.tidyverse.org" class="external-link">readxl</a>, and <a href="https://readr.tidyverse.org" class="external-link">readr</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rmi-pacta.github.io/pacta.loanbook/">pacta.loanbook</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="import-data">Import Data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h3>
<p>We need two datasets to begin: a <a href="cookbook_preparatory_steps.html#raw-loan-book">loanbook</a> and an
<a href="cookbook_preparatory_steps.html#asset-based-company-data-abcd">asset-based
company dataset (abcd)</a>. For more detail about the necessary
structure of these datasets, see the data dictionaries for <a href="data_loanbook.html">loanbook</a> and <a href="data_abcd.html">abcd</a>.</p>
<p>To simulate having these data files prepared, we will use the demo
data included in the <a href="https://rmi-pacta.github.io/pacta.loanbook/">pacta.loanbook</a> package to create
example XLS files using the <a href="https://ropensci.r-universe.dev/writexl" class="external-link">writexl</a> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.r-universe.dev/writexl" class="external-link">writexl</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">writexl</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/writexl//reference/write_xlsx.html" class="external-link">write_xlsx</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">loanbook_demo</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"loanbook.xlsx"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">writexl</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/writexl//reference/write_xlsx.html" class="external-link">write_xlsx</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">abcd_demo</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"abcd.xlsx"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Typically, these data files are stored in XLS files on your computer.
As an example, they could be imported as in the code below using the
<a href="https://readxl.tidyverse.org" class="external-link">readxl</a> package, however, if you use custom data that does
not strictly follow the format as defined in <a href="cookbook_preparatory_steps.html">the previous section</a>, you may
need to adjust the import code and/or do some data manipulation in R
after importing.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"loanbook.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">loanbook</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 283 × 13</span></span></span>
<span><span class="co">#&gt;    id_loan id_direct_loantaker name_direct_loantaker       id_ultimate_parent name_ultimate_parent                   loan_size_outstanding loan_size_outstanding_currency loan_size_credit_limit loan_size_credit_limit_currency sector_classification_system sector_classification_direct_loantaker lei_direct_loantaker isin_direct_loantaker</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> L1      C294                Vitale Group                UP15               Scholz KGaA                                           <span style="text-decoration: underline;">225</span>625 EUR                                          18<span style="text-decoration: underline;">968</span>805 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> L2      C293                Moen-Moen                   UP84               <span style="color: #BB0000;">NA</span>                                                    <span style="text-decoration: underline;">301</span>721 EUR                                          19<span style="text-decoration: underline;">727</span>961 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> L3      C292                Rowe-Rowe                   UP288              Harvey, Harvey and Harvey                             <span style="text-decoration: underline;">410</span>297 EUR                                          20<span style="text-decoration: underline;">811</span>147 EUR                             NACE                         D35.11                                 801600ATB1D513IUFZ77 <span style="color: #BB0000;">NA</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> L4      C299                Fadel-Fadel                 UP54               <span style="color: #BB0000;">NA</span>                                                    <span style="text-decoration: underline;">233</span>049 EUR                                          19<span style="text-decoration: underline;">042</span>869 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> L5      C305                Ring AG &amp; Co. KGaA          UP104              Conti, Conti e Conti SPA                              <span style="text-decoration: underline;">406</span>585 EUR                                          20<span style="text-decoration: underline;">774</span>115 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> L6      C304                Kassulke-Kassulke           UP83               Farrell, Farrell and Farrell                          <span style="text-decoration: underline;">185</span>721 EUR                                          18<span style="text-decoration: underline;">570</span>711 EUR                             NACE                         D35.11                                 108200TUBGG1DR0QR635 <span style="color: #BB0000;">NA</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> L7      C227                Morissette Group            UP134              Weller AG                                             <span style="text-decoration: underline;">184</span>793 EUR                                          18<span style="text-decoration: underline;">561</span>453 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> L8      C303                Barone s.r.l.               UP163              Williamsonn PLC                                       <span style="text-decoration: underline;">291</span>513 EUR                                          19<span style="text-decoration: underline;">626</span>123 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> L9      C301                Werner Werner AG &amp; Co. KGaA UP138              Leone-Leone s.r.l.                                    <span style="text-decoration: underline;">407</span>513 EUR                                          20<span style="text-decoration: underline;">783</span>373 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> L10     C302                De rosa s.r.l.              UP32               Benedetti, Benedetti e Benedetti Group                <span style="text-decoration: underline;">186</span>649 EUR                                          18<span style="text-decoration: underline;">579</span>969 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 273 more rows</span></span></span>
<span></span>
<span><span class="va">abcd</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"abcd.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">abcd</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,972 × 12</span></span></span>
<span><span class="co">#&gt;    company_id name_company                          lei                  sector technology          production_unit  year production emission_factor plant_location is_ultimate_owner emission_factor_unit             </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 175        Giordano, Giordano e Giordano e figli 18500033XH6RG332SX89 power  hydrocap            MW               <span style="text-decoration: underline;">2</span>020    <span style="text-decoration: underline;">121</span>032.          <span style="color: #BB0000;">NA</span>     MY             TRUE              tonnes of CO2 per per hour per MW</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 175        Giordano, Giordano e Giordano e figli 18500033XH6RG332SX89 power  hydrocap            MW               <span style="text-decoration: underline;">2</span>021    <span style="text-decoration: underline;">119</span>274.          <span style="color: #BB0000;">NA</span>     MY             TRUE              tonnes of CO2 per per hour per MW</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 175        Giordano, Giordano e Giordano e figli 18500033XH6RG332SX89 power  hydrocap            MW               <span style="text-decoration: underline;">2</span>022    <span style="text-decoration: underline;">117</span>515.          <span style="color: #BB0000;">NA</span>     MY             TRUE              tonnes of CO2 per per hour per MW</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 175        Giordano, Giordano e Giordano e figli 18500033XH6RG332SX89 power  hydrocap            MW               <span style="text-decoration: underline;">2</span>023    <span style="text-decoration: underline;">115</span>757.          <span style="color: #BB0000;">NA</span>     MY             TRUE              tonnes of CO2 per per hour per MW</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 175        Giordano, Giordano e Giordano e figli 18500033XH6RG332SX89 power  hydrocap            MW               <span style="text-decoration: underline;">2</span>024    <span style="text-decoration: underline;">113</span>999.          <span style="color: #BB0000;">NA</span>     MY             TRUE              tonnes of CO2 per per hour per MW</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 175        Giordano, Giordano e Giordano e figli 18500033XH6RG332SX89 power  hydrocap            MW               <span style="text-decoration: underline;">2</span>025    <span style="text-decoration: underline;">112</span>240.          <span style="color: #BB0000;">NA</span>     MY             TRUE              tonnes of CO2 per per hour per MW</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 526        Vitali, Vitali e Vitali s.r.l.        887100CAVZ6Y3KYT3Q90 cement integrated facility tonnes per year  <span style="text-decoration: underline;">2</span>020   6<span style="text-decoration: underline;">327</span>858.           0.723 CI             TRUE              tonnes of CO2 per tonne of cement</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 526        Vitali, Vitali e Vitali s.r.l.        887100CAVZ6Y3KYT3Q90 cement integrated facility tonnes per year  <span style="text-decoration: underline;">2</span>021   6<span style="text-decoration: underline;">569</span>983.           0.735 CI             TRUE              tonnes of CO2 per tonne of cement</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 526        Vitali, Vitali e Vitali s.r.l.        887100CAVZ6Y3KYT3Q90 cement integrated facility tonnes per year  <span style="text-decoration: underline;">2</span>022   6<span style="text-decoration: underline;">812</span>108.           0.746 CI             TRUE              tonnes of CO2 per tonne of cement</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 526        Vitali, Vitali e Vitali s.r.l.        887100CAVZ6Y3KYT3Q90 cement integrated facility tonnes per year  <span style="text-decoration: underline;">2</span>023   7<span style="text-decoration: underline;">054</span>232.           0.758 CI             TRUE              tonnes of CO2 per tonne of cement</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,962 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="matching-process">Matching Process<a class="anchor" aria-label="anchor" href="#matching-process"></a>
</h3>
<p>The next step after loading all required input files is to run the
matching process, where you will match loans from the loanbook data with
production data from the abcd.</p>
<p>The matching process is divided into three main steps:</p>
<ul>
<li>Apply a matching algorithm to calculate scores of the match
precision between the loanbook and abcd datasets</li>
<li>Manually validate matches between the loanbook and abcd datasets,
including slecting the appropriate match in cases where more than one
company in the abcd receives a score higher than the threshold
value</li>
<li>Prioritize validated matches by level</li>
</ul>
<p>We will cover each of these steps in the following sections.</p>
<div class="section level4">
<h4 id="score-the-match-precision-between-the-loanbook-and-abcd-datasets">Score the match precision between the loanbook and abcd
datasets<a class="anchor" aria-label="anchor" href="#score-the-match-precision-between-the-loanbook-and-abcd-datasets"></a>
</h4>
<p><code><a href="../reference/match_name.html">match_name()</a></code> scores the match between names in a
loanbook dataset and names in an asset-based company dataset. The names
come from the columns <code>name_direct_loantaker</code> and
<code>name_ultimate_parent</code> of the loanbook dataset, and from the
column <code>name_company</code> of the asset-based company dataset. In
the loan book data set, it is possible to optionally add any number of
<code>name_intermediate_parent_*</code> columns, where <code>*</code>
indicates the level up the corporate tree from
<code>direct_loantaker</code>.</p>
<p>The raw names are internally transformed applying best-practices
commonly used in name matching algorithms, such as:</p>
<ul>
<li>Remove special characters</li>
<li>Replace language specific characters</li>
<li>Abbreviate certain names to reduce their importance in the
matching</li>
<li>Remove corporate suffixes when necessary</li>
<li>Spell out numbers to increase their importance</li>
</ul>
<p>The similarity is then scored between the internally-transformed
names of the loanbook against the names in the abcd. For more
information on the scoring algorithm used, see
<code><a href="https://rdrr.io/pkg/stringdist/man/stringsim.html" class="external-link">stringdist::stringsim()</a></code>.</p>
<p>The basic usage of <code><a href="../reference/match_name.html">match_name()</a></code> is as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_name.html">match_name</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">abcd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matched</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 326 × 22</span></span></span>
<span><span class="co">#&gt;    id_loan id_direct_loantaker name_direct_loantaker       id_ultimate_parent name_ultimate_parent         loan_size_outstanding loan_size_outstanding_currency loan_size_credit_limit loan_size_credit_limit_currency sector_classification_system sector_classification_direct_loantaker lei_direct_loantaker isin_direct_loantaker id_2dii level   sector sector_abcd name  name_abcd score source borderline</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> L1      C294                Vitale Group                UP15               Scholz KGaA                                 <span style="text-decoration: underline;">225</span>625 EUR                                          18<span style="text-decoration: underline;">968</span>805 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                    UP190   ultima… power  power       Scho… Scholz K… 1     loanb… FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> L3      C292                Rowe-Rowe                   UP288              Harvey, Harvey and Harvey                   <span style="text-decoration: underline;">410</span>297 EUR                                          20<span style="text-decoration: underline;">811</span>147 EUR                             NACE                         D35.11                                 801600ATB1D513IUFZ77 <span style="color: #BB0000;">NA</span>                    UP101   ultima… power  power       Harv… Harvey, … 1     loanb… FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> L5      C305                Ring AG &amp; Co. KGaA          UP104              Conti, Conti e Conti SPA                    <span style="text-decoration: underline;">406</span>585 EUR                                          20<span style="text-decoration: underline;">774</span>115 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                    UP39    ultima… power  power       Cont… Conti, C… 1     loanb… FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> L6      C304                Kassulke-Kassulke           UP83               Farrell, Farrell and Farrell                <span style="text-decoration: underline;">185</span>721 EUR                                          18<span style="text-decoration: underline;">570</span>711 EUR                             NACE                         D35.11                                 108200TUBGG1DR0QR635 <span style="color: #BB0000;">NA</span>                    DL129   direct… power  power       Kass… Kassulke… 1     loanb… FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> L6      C304                Kassulke-Kassulke           UP83               Farrell, Farrell and Farrell                <span style="text-decoration: underline;">185</span>721 EUR                                          18<span style="text-decoration: underline;">570</span>711 EUR                             NACE                         D35.11                                 108200TUBGG1DR0QR635 <span style="color: #BB0000;">NA</span>                    UP63    ultima… power  power       Farr… Farrell,… 1     loanb… FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> L7      C227                Morissette Group            UP134              Weller AG                                   <span style="text-decoration: underline;">184</span>793 EUR                                          18<span style="text-decoration: underline;">561</span>453 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                    DL179   direct… power  power       Mori… Moretti … 0.911 loanb… FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> L7      C227                Morissette Group            UP134              Weller AG                                   <span style="text-decoration: underline;">184</span>793 EUR                                          18<span style="text-decoration: underline;">561</span>453 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                    UP224   ultima… power  power       Well… Weller AG 1     loanb… FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> L8      C303                Barone s.r.l.               UP163              Williamsonn PLC                             <span style="text-decoration: underline;">291</span>513 EUR                                          19<span style="text-decoration: underline;">626</span>123 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                    UP228   ultima… power  power       Will… Williams… 0.987 loanb… FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> L9      C301                Werner Werner AG &amp; Co. KGaA UP138              Leone-Leone s.r.l.                          <span style="text-decoration: underline;">407</span>513 EUR                                          20<span style="text-decoration: underline;">783</span>373 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                    DL274   direct… power  power       Wern… Wende We… 0.844 loanb… FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> L9      C301                Werner Werner AG &amp; Co. KGaA UP138              Leone-Leone s.r.l.                          <span style="text-decoration: underline;">407</span>513 EUR                                          20<span style="text-decoration: underline;">783</span>373 EUR                             NACE                         D35.11                                 <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                    UP132   ultima… power  power       Leon… Leone-Le… 1     loanb… FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 316 more rows</span></span></span></code></pre></div>
<p><code><a href="../reference/match_name.html">match_name()</a></code> defaults to scoring matches between name
strings that belong to the same sector. This implies that a potential
match will only be shown if the names in the loanbook and the abcd are
sufficiently similar AND the loan is classified in the same sector as
the company activity in the abcd. Using <code>by_sector = FALSE</code>
removes this limitation – increasing computation time, and the number of
potentially incorrect matches to manually validate. In most cases, it is
recommended to keep <code>by_sector = TRUE</code>. However, lifting the
restriction can be helpful in cases where the sector classification in
the loanbook is not reliable or no sector classification is available at
all. Below you can see that the removal of the restriction increases the
number of potential matches.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/match_name.html">match_name</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">abcd</span>, by_sector <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 656</span></span>
<span></span>
<span><span class="co"># Compare to</span></span>
<span><span class="fu"><a href="../reference/match_name.html">match_name</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">abcd</span>, by_sector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 326</span></span></code></pre></div>
<p>The <code>min_score</code> argument allows you to set a minimum
threshold score. This is useful when you either want to filter out
potential matches that are not precise enough, or want to add additional
potential matches because the given suggestions do not seem to provide
sufficient matching coverage. The default value is 0.8, but you can set
it to any value between 0 and 1. Since a higher score implies a closer
match between company names in the loanbook and the abcd, fewer
potential matches will usually be shown. The following code shows how to
set the threshold to 0.9:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/match_name.html">match_name</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">abcd</span>, min_score <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9007692 1.0000000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="manually-validate-matches">Manually validate matches<a class="anchor" aria-label="anchor" href="#manually-validate-matches"></a>
</h4>
<p>After the initial calculation of scores for potential matches, you
will manually have to inspect the suggested matches and decide which
ones to keep or remove. This is especially important when using
text-based matching because there is no guarantee that similar company
names as identified by the algorithm actually refer to the same
companies. The manual validation step is therefore crucial, it ensures
data quality in the remainder of the analysis.</p>
<p>The validation process is not automated and requires some time and
effort on your part. This is often the most time-consuming part of the
analysis, especially when trying to improve the matching coverage in
multiple iterations.</p>
<p>Below you will find a brief description of the manual validation
process:</p>
<p>Write the output of <code><a href="../reference/match_name.html">match_name()</a></code> into a .csv file, for
example using <a href="https://readr.tidyverse.org" class="external-link">readr</a> to save a CSV file:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">matched</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"matched.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Compare, edit, and save the data manually:</p>
<ul>
<li>Open <code>matched.csv</code> with any spreadsheet editor (Excel,
Google Sheets, etc.).</li>
<li>Compare the columns <code>name</code> and <code>name_abcd</code>
manually to determine if the match is valid. Other information can be
used in conjunction with just the names to ensure the two entities match
(sector, internal information on the company structure, etc.)</li>
<li>Edit the data:
<ul>
<li>If you are happy with the match, set the <code>score</code> value to
<code>1</code>.</li>
<li>Otherwise set or leave the <code>score</code> value to anything
other than <code>1</code>.</li>
</ul>
</li>
<li>Save the edited file as, for example,
<code>valid_matches.csv</code>.</li>
</ul>
<p>Re-import the edited file (validated), for example using
<a href="https://readr.tidyverse.org" class="external-link">readr</a> to read a CSV file:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valid_matches</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"valid_matches.csv"</span><span class="op">)</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>You can find more detailed information about the matching process
under the header “PACTA for Banks Training Webinar 2” in the <a href="https://pacta.rmi.org/pacta-for-banks-2020/training-materials/" class="external-link">training
materials section of the PACTA for Banks website</a> and in the <a href="https://pacta.rmi.org/wp-content/uploads/2020/12/PACTA-for-Banks-Training-Webinar-2-Matching-a-loan-book-to-physical-assets-in-the-real-economy-.pdf" class="external-link">corresponding
slide deck</a>.</p>
</div>
<div class="section level4">
<h4 id="prioritize-validated-matches-by-level">Prioritize validated matches by level<a class="anchor" aria-label="anchor" href="#prioritize-validated-matches-by-level"></a>
</h4>
<p>The validated dataset may have multiple matches per loan. Consider
the case where a loan is given to “Acme Power USA”, a subsidiary of
“Acme Power Co.”. There may be both “Acme Power USA” and “Acme Power
Co.” in the <code>abcd</code>, and so there could be two valid matches
for this loan. To get the best match only, use <code><a href="../reference/prioritize.html">prioritize()</a></code>
– it picks rows where <code>score</code> is 1 and <code>level</code> per
loan is of highest <code>priority</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">some_interesting_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id_2dii"</span>, <span class="st">"level"</span>, <span class="st">"score"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prioritized_matches</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">valid_matches</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prioritize.html">prioritize</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prioritized_matches</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">some_interesting_columns</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 177 × 3</span></span></span>
<span><span class="co">#&gt;    id_2dii level            score</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> DL129   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> DL144   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> DL270   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> DL86    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> DL5     direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> DL80    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> DL150   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> DL3     direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> DL65    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> DL79    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 167 more rows</span></span></span></code></pre></div>
<p>By default, highest priority refers to the most granular match
(<code>direct_loantaker</code>). The default priority is set internally
via <code><a href="../reference/prioritize_level.html">prioritize_level()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prioritize_level.html">prioritize_level</a></span><span class="op">(</span><span class="va">valid_matches</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "direct_loantaker" "ultimate_parent"</span></span></code></pre></div>
<p>You may use a different priority. One way to do that is to pass a
function to <code>priority</code>. For example, use <code><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev()</a></code>
to reverse the default priority.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valid_matches</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prioritize.html">prioritize</a></span><span class="op">(</span>priority <span class="op">=</span> <span class="va">rev</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">some_interesting_columns</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 177 × 3</span></span></span>
<span><span class="co">#&gt;    id_2dii level           score</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> UP190   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> UP101   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> UP39    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> UP63    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> UP224   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> UP132   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> UP12    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> UP20    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> UP134   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> UP127   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 167 more rows</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="a-note-on-sector-classifications-and-the-borderline-flag">A Note on Sector Classifications and the <code>borderline</code>
Flag<a class="anchor" aria-label="anchor" href="#a-note-on-sector-classifications-and-the-borderline-flag"></a>
</h4>
<div class="section level5">
<h5 id="a-note-on-sector-classification">A note on sector classification<a class="anchor" aria-label="anchor" href="#a-note-on-sector-classification"></a>
</h5>
<p>Matches are preferred when the sector from the <code>loanbook</code>
matches the sector from the <code>abcd</code>. The <code>loanbook</code>
sector is determined internally by mapping the sector classification
code from the loan book to a PACTA sector, using the
<code>sector_classification_system</code> and
<code>sector_classification_direct_loantaker</code> columns. Currently,
the following options are supported for
<code>sector_classification_system</code>, specified in
<code>sector_classifications</code>:</p>
<blockquote>
<p>GICS, ISIC, NACE, NAICS, PSIC, SIC</p>
</blockquote>
</div>
<div class="section level5">
<h5 id="the-borderline-flag">The <code>borderline</code> flag<a class="anchor" aria-label="anchor" href="#the-borderline-flag"></a>
</h5>
<p>An issue arises when, for example, a company is classified in the
“power transmission” sector. In a perfect world, these companies would
produce no electricity, and we would not try to match them. In practice,
however, we find there is often overlap, as companies may have
integrated business models that span multiple steps of the supply chain
or sector classification systems do not break down every code clearly
enough to map it to PACTA sectors unambiguously. For this reason, we
introduced the <code>borderline</code> flag.</p>
<p>In the example below, we see two classification codes coming from the
NACE classification standard:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nace_classification</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D35.11"</span>, <span class="st">"D35.14"</span>, <span class="st">"D35.1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">#&gt;   original_code description                      code  sector borderline version</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 35.1          35.1 Electric power generation,… D35.1 power  TRUE       2.1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 35.11         35.11 Production of electricity… D35.… power  FALSE      2.1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 35.14         35.14 Distribution of electrici… D35.… power  TRUE       2.1</span></span></code></pre></div>
<p>Notice that the code D35.11 corresponds to power generation. This is
an identical match to <code>power</code> sector in PACTA, and thus the
<code>borderline</code> flag is set to <code>FALSE</code>. In contrast,
code D35.14 corresponds to the distribution of electricity. In a perfect
world, we would set this code to <code>not in scope</code>, however
there is still a chance that these companies produce electricity. For
this reason, we have mapped it to <code>power</code> with
<code>borderline = TRUE</code>. Finally, code D35.1 corresponds to the
wider electricity sector, covering “Electric power generation,
transmission and distribution”. This is a case where the granularity is
insufficient to unambiguously match the code to the <code>power</code>
sector as defined in PACTA, and thus the <code>borderline</code> flag is
set to <code>TRUE</code>.</p>
<p>In practice, if a company has a sector code with
<code>borderline</code> is <code>TRUE</code> and <em>is</em> matched,
then consider the company in scope. If it has a <code>borderline</code>
value <code>TRUE</code> and <em>is not</em> matched, then consider it
out of scope.</p>
</div>
</div>
<div class="section level4">
<h4 id="optional-prepare-own-sector-classification-mapper">Optional: Prepare own sector classification mapper<a class="anchor" aria-label="anchor" href="#optional-prepare-own-sector-classification-mapper"></a>
</h4>
<p>If you can obtain sector codes in any one of those classification
systems for your loan book, it is strongly recommended using them. If
you do not have your loans mapped to any of these systems, you can
either run the matching without a sector classification (see above), or
you can use a custom sector classification system.</p>
<p>If you want to use your own custom sector classification system, you
will need to create a file that follows the same structure as the sector
classification files in <code>sector_classifications</code>, that is,
the file needs to contain the following columns (of the following
types):</p>
<ul>
<li>
<code>sector</code>: character</li>
<li>
<code>borderline</code>: logical</li>
<li>
<code>code</code>: character</li>
<li>
<code>code_system</code>: character</li>
</ul>
<p>Please notice that when manually preparing a custom sector
classification file, you need to decide for every code of your mapping
system which PACTA sector the code maps to. This requires the system to
be relatively granular to capture the nuances of the supply chains of
the companies in your loan book. As discussed above, any sector code
that is not unambiguously in scope or out of scope for a given PACTA
sector should be marked <code>TRUE</code> in the <code>borderline</code>
column. Any sector code that is clearly not in scope should be marked
<code>FALSE</code> and receive the sector value
<code>not in scope</code>. Any sector code that is clearly in scope
should be marked <code>FALSE</code> for <code>borderline</code> and
receive the PACTA sector value that it maps to in the
<code>sector</code> column.</p>
<p><strong>ADD EXAMPLE</strong></p>
</div>
<div class="section level4">
<h4 id="calculate-the-match-success-rate">Calculate the Match Success Rate<a class="anchor" aria-label="anchor" href="#calculate-the-match-success-rate"></a>
</h4>
<p><a href="https://rmi-pacta.github.io/pacta.loanbook/">pacta.loanbook</a> allows you to match loans from your
loanbook to the companies in an asset-based company dataset. However,
matching every loan is unlikely – some loan-taking companies may be
missing from the asset-based company dataset, or they may not operate in
the sectors PACTA focuses on (power, cement, oil and gas, aviation,
coal, automotive, steel, and hdv). Thus, you may want to measure how
much of the loanbook matched some asset. This article shows two ways to
calculate such matching coverage:</p>
<ol style="list-style-type: decimal">
<li><p>Calculate the portion of your <code>loanbook</code> covered, by
dollar value (i.e. using one of the <code>loan_size_*</code>
columns).</p></li>
<li><p>Count the number of companies matched.</p></li>
</ol>
<p>First we will need to load the additional useful package
<a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>We will use the example datasets created in the previous section. To
demonstrate our point, we create a <code>loanbook</code> dataset with
two mismatching loans:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook</span> <span class="op">&lt;-</span> <span class="va">loanbook</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    name_ultimate_parent <span class="op">=</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">id_loan</span> <span class="op">==</span> <span class="st">"L1"</span>, <span class="st">"unmatched company name"</span>, <span class="va">name_ultimate_parent</span><span class="op">)</span>,</span>
<span>    sector_classification_direct_loantaker <span class="op">=</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">id_loan</span> <span class="op">==</span> <span class="st">"L2"</span>, <span class="st">"99"</span>, <span class="va">sector_classification_direct_loantaker</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We will then run the matching algorithm on this loanbook:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="va">loanbook</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/match_name.html">match_name</a></span><span class="op">(</span><span class="va">abcd</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/prioritize.html">prioritize</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some `sector_classification_direct_loantaker` are unknown:99</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> If you wish to request a new sector classification system, please create an issue here:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> https://github.com/RMI-PACTA/r2dii.data/issues</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Or contact the PACTA team here:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> pacta4banks@rmi.org</span></span></code></pre></div>
<p>Note that this <code>matched</code> dataset will contain
<em>only</em> loans that were matched successfully. To determine
coverage, we need to go back to the original <code>loanbook</code>
dataset. We must determine the PACTA sectors of each loan, as dictated
by the <code>sector_classification_direct_loantaker</code> column.</p>
<p>For this, we join the <code>loanbook</code> with the
<code>sector_classifications</code> dataset, which lists all sector
classification code standards used by ‘PACTA’. Unfortunately we need to
work around two caveats (you may ignore them because they are
conceptually uninteresting):</p>
<ul>
<li><p>In the two datasets, the columns we want to merge by have
different names. We use the argument <code>by</code> of
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code> to merge the columns
<code>sector_classification_system</code> and
<code>sector_classification_direct_loantaker</code> (from
<code>loanbook</code>) with the columns <code>code_system</code> and
<code>code</code> (from <code>sector_classifications</code>),
respectively.</p></li>
<li><p>In the two datasets, the sector classification codes are
represented with different data-types. We modify the column
<code>sector_classification_direct_loantaker</code> before using
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code> so it has the same type as the
corresponding column <code>code</code> (otherwise
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code> throws an error), and again after
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code> to restore its original type.</p></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merge_by</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    sector_classification_system <span class="op">=</span> <span class="st">"code_system"</span>,</span>
<span>    sector_classification_direct_loantaker <span class="op">=</span> <span class="st">"code"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">loanbook_with_sectors</span> <span class="op">&lt;-</span> <span class="va">loanbook</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sector_classifications</span>, by <span class="op">=</span> <span class="va">merge_by</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sector_classification_direct_loantaker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">sector_classification_direct_loantaker</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can join these two datasets together, to generate our
<code>coverage</code> dataset:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">loanbook_with_sectors</span>, <span class="va">matched</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    loan_size_outstanding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">loan_size_outstanding</span><span class="op">)</span>,</span>
<span>    loan_size_credit_limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">loan_size_credit_limit</span><span class="op">)</span>,</span>
<span>    matched <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">score</span> <span class="op">==</span> <span class="fl">1</span>   <span class="op">~</span> <span class="st">"Matched"</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Not Matched"</span>,</span>
<span>      <span class="cn">TRUE</span>         <span class="op">~</span> <span class="st">"Not Matched"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    sector <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">borderline</span> <span class="op">==</span> <span class="cn">TRUE</span> <span class="op">&amp;</span> <span class="va">matched</span> <span class="op">==</span> <span class="st">"Not Matched"</span> <span class="op">~</span> <span class="st">"not in scope"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">sector</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(id_loan, id_direct_loantaker, name_direct_loantaker,</span></span>
<span><span class="co">#&gt; id_ultimate_parent, name_ultimate_parent, loan_size_outstanding,</span></span>
<span><span class="co">#&gt; loan_size_outstanding_currency, loan_size_credit_limit,</span></span>
<span><span class="co">#&gt; loan_size_credit_limit_currency, sector_classification_system,</span></span>
<span><span class="co">#&gt; sector_classification_direct_loantaker, lei_direct_loantaker,</span></span>
<span><span class="co">#&gt; isin_direct_loantaker, sector, borderline)`</span></span></code></pre></div>
<div class="section level5">
<h5 id="calculate-the-portion-of-your-loanbook-covered-by-dollar-value">1. Calculate the portion of your loanbook covered by dollar
value<a class="anchor" aria-label="anchor" href="#calculate-the-portion-of-your-loanbook-covered-by-dollar-value"></a>
</h5>
<p>From the <code>coverage</code> dataset, we can calculate the total
loanbook coverage by dollar value. Let’s create two helper functions,
one to calculate dollar-value and another one to plot coverage in
general.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dollar_value</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>loan_size_outstanding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">loan_size_outstanding</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">matched</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plot_coverage</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">x</span><span class="op">}</span><span class="op">}</span>, <span class="op">{</span><span class="op">{</span><span class="va">y</span><span class="op">}</span><span class="op">}</span>, fill <span class="op">=</span> <span class="va">matched</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># Use more horizontal space -- avoids overlap on x axis text</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s first explore all loans.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dollar_value</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">matched</span>, <span class="va">loan_size_outstanding</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_running_the_analysis_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>To calculate the total, in-scope, loanbook coverage:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sector</span> <span class="op">!=</span> <span class="st">"not in scope"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dollar_value</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">matched</span>, <span class="va">loan_size_outstanding</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_running_the_analysis_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="break-down-by-sector">Break down by sector<a class="anchor" aria-label="anchor" href="#break-down-by-sector"></a>
</h5>
<p>You may break-down the plot by sector:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dollar_value</span><span class="op">(</span><span class="va">sector</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">sector</span>, <span class="va">loan_size_outstanding</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_running_the_analysis_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<p>Or even further, by matching level:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>matched <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"direct_loantaker"</span>      <span class="op">~</span> <span class="st">"Matched DL"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"intermediate_parent_1"</span> <span class="op">~</span> <span class="st">"Matched IP1"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"ultimate_parent"</span>       <span class="op">~</span> <span class="st">"Matched UP"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Not Matched"</span>                                <span class="op">~</span> <span class="st">"Not Matched"</span>,</span>
<span>    <span class="cn">TRUE</span>                                                    <span class="op">~</span> <span class="st">"Catch unknown"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dollar_value</span><span class="op">(</span><span class="va">sector</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">sector</span>, <span class="va">loan_size_outstanding</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_running_the_analysis_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="count-the-number-of-companies">2. Count the number of companies<a class="anchor" aria-label="anchor" href="#count-the-number-of-companies"></a>
</h5>
<p>You might also be interested in knowing how many companies in your
loanbook were matched. It probably makes most sense to do this at the
<code>direct_loantaker</code> level:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">companies_matched</span> <span class="op">&lt;-</span> <span class="va">coverage</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>no_companies <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">name_direct_loantaker</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sector</span>, <span class="va">matched</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">companies_matched</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">sector</span>, <span class="va">no_companies</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_running_the_analysis_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
</div>
</div>
<div class="section level4">
<h4 id="optional-handling-misclassified-loans">Optional: Handling misclassified loans<a class="anchor" aria-label="anchor" href="#optional-handling-misclassified-loans"></a>
</h4>
<p>A loan is considered misclassified, if it is identified as in-scope
of a PACTA sector based on the sector classification in the input loan
book, but if it turns out that this classification is incorrect based on
the counterparty’s activities. For example, if a counterparty is
classified as a fully in-scope power company, but in reality it is a
power distribution company or even active in another sector altogether,
such as upstream gas production, the counterparty is misclassified.
Misclassification is a problem, because it leads to exaggeratedly low
match success rates, that cannot be improved by iterating the matching
process. You can search as long as you want, but a company that in
reality does not operate any power plants will not be found in the ABCD
regardless of how the settings of the matching algorithm are tweaked.
The match success rate can only be a useful metric if the denominator,
that is the classification in the loan book, is solid. This is also
important to understand which loans are truly not matched. This category
should only be companies that actually are active in a given in-scope
sector, but were not found in the ABCD.</p>
<p>Identifying misclassified loans is usually a manual process, where
counterparties that have not been matched are researched to determine if
they should be in scope or not. Depending on the size of the loan book,
this can be a time-consuming process. It is recommended to start with
the unmatched counterparties with the largest loans, as these have the
largest impact on the match success rate. You may then have to decide
for yourself, if you want to research all unmatched loans or set a
cutoff point, e.g. based on the size of the loan.</p>
<p>Once the list of misclassified loans is identified, there are two
broad options to appropriately these cases.</p>
<ol style="list-style-type: decimal">
<li>Correct the classification in the raw loan book and re-run the
matching process. If the loan was clearly misclassified, this may be the
most appropriate way to handle the issue. It may be a good idea to keep
notes on any such changes made in the input data though, to ensure the
result is fully replicable. The upside of this approach is that the loan
will now either be matched correctly, as it will be assigned the sector
that the company should have and therefore find an entry in the ABCD
data set to match against. Or, if there is still no match to be found in
the ABCD, the loan will correctly be missing in the appropriate sector
and therefore indicate a lower match success rate where it should.
Lastly, if it should have been <code>"not in scope"</code>, it will not
inflate the denominator of the match success rate anymore.</li>
<li>If a manual re-classification of the raw loan book is not possible
or desired, the calculation of the match success rate can be corrected
by creating a file <code>loans_to_remove.csv</code>, which should
include the column <code>id_loan</code> to indicate the precise
misclassified loan that was identified. This loan then needs to be
explicitly removed from the match success calculation, as shown
below.</li>
</ol>
<p>Let’s assume the the loan with id L255 is falsely classified as a
steel company. Research shows this company is not a primary steel
prodcuer, but it makes steel-based products for end use. Hence it is
active downstream in the value chain and cannot be matched to the ABCD.
If we cannot correct the input sector classification, we instead create
a csv file with the id of the misclassified loan. In practice, this can
be done prgramatically or manually.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id_loan <span class="op">=</span> <span class="st">"L255"</span><span class="op">)</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"loans_to_remove.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The loans_to_remove.csv file should have just one column, id_loan,
and therefore be structured as follows:</p>
<ul>
<li>
<code>id_loan</code>: character</li>
</ul>
<p>We then read in the file and remove the misclassified loan from the
match success rate calculation. We compare the coverage before and after
the removal of the misclassified loan to see the impact of the
correction. For demonstration purposes, we artificially increase the
loan_size_outstanding of the affected counterparty while focusing on the
steel sector only, to see the clear impact.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage_compare</span> <span class="op">&lt;-</span> <span class="va">coverage</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    loan_size_outstanding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">id_loan</span> <span class="op">==</span> <span class="st">"L255"</span>, <span class="fl">50000000</span>, <span class="va">loan_size_outstanding</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sector</span> <span class="op">==</span> <span class="st">"steel"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coverage_compare</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>matched <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"direct_loantaker"</span>      <span class="op">~</span> <span class="st">"Matched DL"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"intermediate_parent_1"</span> <span class="op">~</span> <span class="st">"Matched IP1"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"ultimate_parent"</span>       <span class="op">~</span> <span class="st">"Matched UP"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Not Matched"</span>                                <span class="op">~</span> <span class="st">"Not Matched"</span>,</span>
<span>    <span class="cn">TRUE</span>                                                    <span class="op">~</span> <span class="st">"Catch unknown"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dollar_value</span><span class="op">(</span><span class="va">sector</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">sector</span>, <span class="va">loan_size_outstanding</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_running_the_analysis_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">loans_to_remove</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"loans_to_remove.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coverage_corrected</span> <span class="op">&lt;-</span> <span class="va">coverage_compare</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">loans_to_remove</span>, by <span class="op">=</span> <span class="st">"id_loan"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coverage_corrected</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>matched <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"direct_loantaker"</span>      <span class="op">~</span> <span class="st">"Matched DL"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"intermediate_parent_1"</span> <span class="op">~</span> <span class="st">"Matched IP1"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Matched"</span> <span class="op">&amp;</span> <span class="va">level</span> <span class="op">==</span> <span class="st">"ultimate_parent"</span>       <span class="op">~</span> <span class="st">"Matched UP"</span>,</span>
<span>    <span class="va">matched</span> <span class="op">==</span> <span class="st">"Not Matched"</span>                                <span class="op">~</span> <span class="st">"Not Matched"</span>,</span>
<span>    <span class="cn">TRUE</span>                                                    <span class="op">~</span> <span class="st">"Catch unknown"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dollar_value</span><span class="op">(</span><span class="va">sector</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">plot_coverage</span><span class="op">(</span><span class="va">sector</span>, <span class="va">loan_size_outstanding</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_running_the_analysis_files/figure-html/unnamed-chunk-29-2.png" width="700"></p>
<p>The reason why it is a good idea to either correct misclassified
loans or disregard them in the calculation of the match success rate is
that a misclassified loan cannot possibly be matched in a given sector.
Therefore, no amount of work would be sufficient to improve the sector
match success rate, because it is calculated against an incorrect
baseline. Technically, the user is not forced to correct
misclassifications, and there may be a limit to how much time should be
spent on this, but it is recommended to at least correct large
misclassified loans.</p>
<p>…</p>
</div>
</div>
<div class="section level3">
<h3 id="calculate-pacta-alignment-metrics">Calculate PACTA alignment metrics<a class="anchor" aria-label="anchor" href="#calculate-pacta-alignment-metrics"></a>
</h3>
<p>You can calculate scenario targets using two different approaches:
Market Share Approach, or Sectoral Decarbonization Approach.</p>
<div class="section level4">
<h4 id="market-share-approach">Market Share Approach<a class="anchor" aria-label="anchor" href="#market-share-approach"></a>
</h4>
<p>The <a href="https://rmi-pacta.github.io/r2dii.analysis/articles/target-market-share.html" class="external-link">Market
Share Approach</a> is used to calculate scenario targets for the
<code>production</code> of a technology in a sector. For example, we can
use this approach to set targets for the production of electric vehicles
in the automotive sector. This approach is recommended for sectors where
a granular technology scenario roadmap exists.</p>
<p>Targets can be set at the portfolio level:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use these datasets to practice but eventually you should use your own data.</span></span>
<span><span class="va">scenario</span> <span class="op">&lt;-</span> <span class="va">scenario_demo_2020</span></span>
<span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="va">region_isos_demo</span></span>
<span></span>
<span><span class="va">market_share_targets_portfolio</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/target_market_share.html">target_market_share</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">prioritized_matches</span>,</span>
<span>    abcd <span class="op">=</span> <span class="va">abcd</span>,</span>
<span>    scenario <span class="op">=</span> <span class="va">scenario</span>,</span>
<span>    region_isos <span class="op">=</span> <span class="va">regions</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">market_share_targets_portfolio</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,076 × 10</span></span></span>
<span><span class="co">#&gt;    sector     technology  year region scenario_source metric     production technology_share scope  percentage_of_initial_production_by_scope</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       projected     <span style="text-decoration: underline;">145</span>649.            0.165 sector                                  0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       target_cps    <span style="text-decoration: underline;">145</span>649.            0.165 sector                                  0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       target_sds    <span style="text-decoration: underline;">145</span>649.            0.165 sector                                  0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       target_sps    <span style="text-decoration: underline;">145</span>649.            0.165 sector                                  0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> automotive electric    <span style="text-decoration: underline;">2</span>021 global demo_2020       projected     <span style="text-decoration: underline;">147</span>480.            0.165 sector                                  0.000<span style="text-decoration: underline;">739</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> automotive electric    <span style="text-decoration: underline;">2</span>021 global demo_2020       target_cps    <span style="text-decoration: underline;">146</span>915.            0.165 sector                                  0.000<span style="text-decoration: underline;">511</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> automotive electric    <span style="text-decoration: underline;">2</span>021 global demo_2020       target_sds    <span style="text-decoration: underline;">153</span>332.            0.167 sector                                  0.003<span style="text-decoration: underline;">10</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> automotive electric    <span style="text-decoration: underline;">2</span>021 global demo_2020       target_sps    <span style="text-decoration: underline;">147</span>258.            0.165 sector                                  0.000<span style="text-decoration: underline;">649</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> automotive electric    <span style="text-decoration: underline;">2</span>022 global demo_2020       projected     <span style="text-decoration: underline;">149</span>310.            0.165 sector                                  0.001<span style="text-decoration: underline;">48</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> automotive electric    <span style="text-decoration: underline;">2</span>022 global demo_2020       target_cps    <span style="text-decoration: underline;">148</span>155.            0.164 sector                                  0.001<span style="text-decoration: underline;">01</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,066 more rows</span></span></span></code></pre></div>
<p>Or at the company level:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">market_share_targets_company</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/target_market_share.html">target_market_share</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">prioritized_matches</span>,</span>
<span>    abcd <span class="op">=</span> <span class="va">abcd</span>,</span>
<span>    scenario <span class="op">=</span> <span class="va">scenario</span>,</span>
<span>    region_isos <span class="op">=</span> <span class="va">regions</span>,</span>
<span>    by_company <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Output results at company-level</span></span>
<span>    weight_production <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">market_share_targets_company</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14,505 × 11</span></span></span>
<span><span class="co">#&gt;    sector     technology  year region scenario_source name_abcd                         metric     production technology_share scope  percentage_of_initial_production_by_scope</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Bernardi, Bernardi e Bernardi SPA projected     <span style="text-decoration: underline;">324</span>592.           0.075<span style="text-decoration: underline;">9</span> sector                                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Bernardi, Bernardi e Bernardi SPA target_cps    <span style="text-decoration: underline;">324</span>592.           0.075<span style="text-decoration: underline;">9</span> sector                                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Bernardi, Bernardi e Bernardi SPA target_sds    <span style="text-decoration: underline;">324</span>592.           0.075<span style="text-decoration: underline;">9</span> sector                                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Bernardi, Bernardi e Bernardi SPA target_sps    <span style="text-decoration: underline;">324</span>592.           0.075<span style="text-decoration: underline;">9</span> sector                                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Christiansen PLC                  projected     <span style="text-decoration: underline;">512</span>438.           0.130  sector                                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Christiansen PLC                  target_cps    <span style="text-decoration: underline;">512</span>438.           0.130  sector                                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Christiansen PLC                  target_sds    <span style="text-decoration: underline;">512</span>438.           0.130  sector                                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Christiansen PLC                  target_sps    <span style="text-decoration: underline;">512</span>438.           0.130  sector                                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Donati, Donati e Donati s.r.l.    projected     <span style="text-decoration: underline;">277</span>214.           1      sector                                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> automotive electric    <span style="text-decoration: underline;">2</span>020 global demo_2020       Donati, Donati e Donati s.r.l.    target_cps    <span style="text-decoration: underline;">277</span>214.           1      sector                                         0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 14,495 more rows</span></span></span></code></pre></div>
<p>These results can be saved/written to a CSV file for potential input
to other models and software, for example:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">market_share_targets_portfolio</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"market_share_targets_portfolio.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">market_share_targets_company</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"market_share_targets_company.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Remember to replace <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code> with the path to the
directory that you wish to save your files in.</p>
</div>
<div class="section level4">
<h4 id="sectoral-decarbonization-approach">Sectoral Decarbonization Approach<a class="anchor" aria-label="anchor" href="#sectoral-decarbonization-approach"></a>
</h4>
<p>The <a href="https://rmi-pacta.github.io/r2dii.analysis/articles/target-sda.html" class="external-link">Sectoral
Decarbonization Approach</a> is used to calculate scenario targets for
the <code>emission_factor</code> of a sector. For example, you can use
this approach to set targets for the average emission factor of the
cement sector. This approach is recommended for sectors lacking
technology roadmaps.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use this dataset to practice but eventually you should use your own data.</span></span>
<span><span class="va">co2</span> <span class="op">&lt;-</span> <span class="va">co2_intensity_scenario_demo</span></span>
<span></span>
<span><span class="va">sda_targets</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/target_sda.html">target_sda</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">prioritized_matches</span>,</span>
<span>    abcd <span class="op">=</span> <span class="va">abcd</span>,</span>
<span>    co2_intensity_scenario <span class="op">=</span> <span class="va">co2</span>,</span>
<span>    region_isos <span class="op">=</span> <span class="va">regions</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sector</span> <span class="op">==</span> <span class="st">"cement"</span>, <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2020</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removing rows in abcd where `emission_factor` is NA</span></span>
<span></span>
<span><span class="va">sda_targets</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 110 × 6</span></span></span>
<span><span class="co">#&gt;    sector  year region             scenario_source emission_factor_metric emission_factor_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> cement  <span style="text-decoration: underline;">2</span>020 advanced economies demo_2020       projected                             0.023<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> cement  <span style="text-decoration: underline;">2</span>020 developing asia    demo_2020       projected                             0.059<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> cement  <span style="text-decoration: underline;">2</span>020 global             demo_2020       projected                             0.664 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> cement  <span style="text-decoration: underline;">2</span>021 advanced economies demo_2020       projected                             0.023<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> cement  <span style="text-decoration: underline;">2</span>021 developing asia    demo_2020       projected                             0.059<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> cement  <span style="text-decoration: underline;">2</span>021 global             demo_2020       projected                             0.665 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> cement  <span style="text-decoration: underline;">2</span>022 advanced economies demo_2020       projected                             0.023<span style="text-decoration: underline;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> cement  <span style="text-decoration: underline;">2</span>022 developing asia    demo_2020       projected                             0.059<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> cement  <span style="text-decoration: underline;">2</span>022 global             demo_2020       projected                             0.666 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> cement  <span style="text-decoration: underline;">2</span>023 advanced economies demo_2020       projected                             0.023<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 100 more rows</span></span></span></code></pre></div>
<p>Or at the company level:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sda_targets_company</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/target_sda.html">target_sda</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">prioritized_matches</span>,</span>
<span>    abcd <span class="op">=</span> <span class="va">abcd</span>,</span>
<span>    co2_intensity_scenario <span class="op">=</span> <span class="va">co2</span>,</span>
<span>    region_isos <span class="op">=</span> <span class="va">regions</span>,</span>
<span>    by_company <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># Output results at company-level</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removing rows in abcd where `emission_factor` is NA</span></span>
<span></span>
<span><span class="va">sda_targets_company</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 966 × 7</span></span></span>
<span><span class="co">#&gt;    sector  year region             scenario_source name_abcd                          emission_factor_metric emission_factor_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> cement  <span style="text-decoration: underline;">2</span>020 advanced economies demo_2020       Milani, Milani e Milani SPA        projected                              0.714</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> cement  <span style="text-decoration: underline;">2</span>020 developing asia    demo_2020       Heidrich GmbH                      projected                              0.675</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> cement  <span style="text-decoration: underline;">2</span>020 developing asia    demo_2020       Hovel Hovel GmbH &amp; Co. KGaA        projected                              0.622</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> cement  <span style="text-decoration: underline;">2</span>020 global             demo_2020       Battaglia-Battaglia Group          projected                              0.626</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> cement  <span style="text-decoration: underline;">2</span>020 global             demo_2020       Bergstrom, Bergstrom and Bergstrom projected                              0.607</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> cement  <span style="text-decoration: underline;">2</span>020 global             demo_2020       Carsten GmbH &amp; Co. KG              projected                              0.625</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> cement  <span style="text-decoration: underline;">2</span>020 global             demo_2020       Crist-Crist                        projected                              0.655</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> cement  <span style="text-decoration: underline;">2</span>020 global             demo_2020       Durgan-Durgan                      projected                              0.702</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> cement  <span style="text-decoration: underline;">2</span>020 global             demo_2020       Eberhardt Eberhardt GmbH           projected                              0.685</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> cement  <span style="text-decoration: underline;">2</span>020 global             demo_2020       Geissler Geissler AG &amp; Co. KGaA    projected                              0.637</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 956 more rows</span></span></span></code></pre></div>
<p>These results can be saved/written to a CSV file for potential input
to other models and software, for example:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sda_targets</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"sda_targets.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sda_targets_company</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"sda_targets_company.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Remember to replace <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code> with the path to the
directory that you wish to save your files in.</p>
</div>
</div>
<div class="section level3">
<h3 id="visualize-pacta-alignment-metrics">Visualize PACTA alignment metrics<a class="anchor" aria-label="anchor" href="#visualize-pacta-alignment-metrics"></a>
</h3>
<p>There are a large variety of possible visualizations stemming from
the outputs of <code><a href="../reference/target_market_share.html">target_market_share()</a></code> and
<code><a href="../reference/target_sda.html">target_sda()</a></code>. Below, we highlight a couple of common plots
that can easily be created using the <a href="https://rmi-pacta.github.io/pacta.loanbook/">pacta.loanbook</a>
package.</p>
<div class="section level4">
<h4 id="market-share-sector-level-technology-mix">Market Share: Sector-level technology mix<a class="anchor" aria-label="anchor" href="#market-share-sector-level-technology-mix"></a>
</h4>
<p>From the market share output, you can plot the portfolio’s exposure
to various climate sensitive technologies (<code>projected</code>), and
compare with the corporate economy, or against various scenario
targets.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pick the targets you want to plot.</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">market_share_targets_portfolio</span>,</span>
<span>  <span class="va">scenario_source</span> <span class="op">==</span> <span class="st">"demo_2020"</span>,</span>
<span>  <span class="va">sector</span> <span class="op">==</span> <span class="st">"power"</span>,</span>
<span>  <span class="va">region</span> <span class="op">==</span> <span class="st">"global"</span>,</span>
<span>  <span class="va">metric</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"projected"</span>, <span class="st">"corporate_economy"</span>, <span class="st">"target_sds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the technology mix</span></span>
<span><span class="fu"><a href="../reference/qplot_techmix.html">qplot_techmix</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; The `technology_share` values are plotted for extreme years.</span></span>
<span><span class="co">#&gt; Do you want to plot different years? E.g. filter . with:`subset(., year %in% c(2020, 2030))`.</span></span>
<span><span class="co">#&gt; Warning: Removed 3 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_bar()`).</span></span></code></pre></div>
<p><img src="cookbook_running_the_analysis_files/figure-html/technoloy-mix-portfolio-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="market-share-technology-level-volume-trajectory">Market Share: Technology-level volume trajectory<a class="anchor" aria-label="anchor" href="#market-share-technology-level-volume-trajectory"></a>
</h4>
<p>You can also plot the technology-specific volume trend. All starting
values are normalized to 1, to emphasize that we are comparing the rates
of buildout and/or retirement.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">market_share_targets_portfolio</span>,</span>
<span>  <span class="va">sector</span> <span class="op">==</span> <span class="st">"power"</span>,</span>
<span>  <span class="va">technology</span> <span class="op">==</span> <span class="st">"renewablescap"</span>,</span>
<span>  <span class="va">region</span> <span class="op">==</span> <span class="st">"global"</span>,</span>
<span>  <span class="va">scenario_source</span> <span class="op">==</span> <span class="st">"demo_2020"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/qplot_trajectory.html">qplot_trajectory</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_running_the_analysis_files/figure-html/trajetory-portfolio-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="sda-target-sector-level-emission-intensity">SDA Target: Sector-level emission intensity<a class="anchor" aria-label="anchor" href="#sda-target-sector-level-emission-intensity"></a>
</h4>
<p>From the SDA output, we can compare the projected average emission
intensity attributed to the portfolio, with the actual emission
intensity scenario, and the scenario compliant SDA pathway that the
portfolio must follow to achieve the scenario ambition by 2050.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sda_targets</span>, <span class="va">sector</span> <span class="op">==</span> <span class="st">"cement"</span>, <span class="va">region</span> <span class="op">==</span> <span class="st">"global"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/qplot_emission_intensity.html">qplot_emission_intensity</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p><img src="cookbook_running_the_analysis_files/figure-html/sda%20plot-1.png" width="700"></p>
<p><strong>ADD ISNTRUCTIONS</strong> Write to file</p>
<p><strong>PREVIOUS CHAPTER:</strong> <a href="cookbook_preparatory_steps.html">Preparatory Steps</a></p>
<p><strong>NEXT CHAPTER:</strong> <a href="cookbook_interpretation.html">Interpretation of Results</a></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="../rmi_logo_stacked_tag_white.svg" alt="RMI logo">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://pacta.rmi.org/" target="_blank" class="external-link"><div class="icon fa fa-link"></div></a>
                        <a href="https://github.com/RMI-PACTA" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://twitter.com/RockyMtnInst" target="_blank" class="external-link"><div class="icon fab fa-twitter"></div></a>
                        <a href="https://www.linkedin.com/showcase/rmi-pacta/" target="_blank" class="external-link"><div class="icon fab fa-linkedin-in"></div></a>
                    </div>
                </div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>© RMI</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
</div>
<!-- / end footer -->

    
   





  </body>
</html>
